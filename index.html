<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>US Import Cost (Ameriabank)</title>
<style>
body {
    font-family: Arial, sans-serif;
    max-width: 420px;
    margin: auto;
    padding: 20px;
}
input {
    width: 100%;
    padding: 8px;
    margin: 6px 0;
}
button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 16px;
}
.result {
    margin-top: 15px;
    font-weight: bold;
}
.rate {
    font-size: 14px;
    color: #555;
}
</style>
</head>
<body>

<h2>US Import Cost</h2>

<div class="rate" id="rates">Loading Ameriabank ratesâ€¦</div>

<label>Item price (USD)</label>
<input id="price" type="number" step="0.01">

<label>US shipping (USD)</label>
<input id="shipping" type="number" step="0.01">

<label>Weight (kg)</label>
<input id="weight" type="number" step="0.01">

<button onclick="calculate()">Calculate</button>

<div class="result" id="output"></div>

<script>
let usdAmd = 379;   // fallback
let eurAmd = 450;   // fallback

async function loadRates() {
    try {
        const res = await fetch(
            "https://api.allorigins.win/raw?url=https://ameriabank.am/en/exchange-rates"
        );
        const html = await res.text();

        const usdMatch = html.match(/USD[^0-9]*([0-9]+\.[0-9]+)/);
        const eurMatch = html.match(/EUR[^0-9]*([0-9]+\.[0-9]+)/);

        if (usdMatch && eurMatch) {
            usdAmd = parseFloat(usdMatch[1]);
            eurAmd = parseFloat(eurMatch[1]);
        }

        document.getElementById("rates").innerHTML =
            `Ameriabank rates loaded<br>
             1 USD = ${usdAmd} AMD<br>
             1 EUR = ${eurAmd} AMD`;

    } catch (e) {
        document.getElementById("rates").innerHTML =
            `Using fallback rates<br>
             1 USD = ${usdAmd} AMD<br>
             1 EUR = ${eurAmd} AMD`;
    }
}

function calculate() {
    const price = Number(price.value);
    const shipping = Number(shipping.value);
    const weight = Number(weight.value);

    const usdEur = usdAmd / eurAmd;

    const subtotalUSD = price + shipping;
    const subtotalEUR = subtotalUSD * usdEur;

    let taxEUR = 0;
    if (subtotalEUR > 200) {
        taxEUR = (subtotalEUR - 200) * 0.15;
    }

    const taxAMD = taxEUR * eurAmd;
    const freightAMD = weight * 6000;
    const itemAMD = subtotalUSD * usdAmd;

    const totalAMD = itemAMD + taxAMD + freightAMD;

    output.innerHTML =
        `Item: ${itemAMD.toFixed(0)} AMD<br>` +
        `Tax: ${taxAMD.toFixed(0)} AMD<br>` +
        `Freight: ${freightAMD.toFixed(0)} AMD<br><br>` +
        `TOTAL: ${totalAMD.toFixed(0)} AMD`;
}

loadRates();
</script>

</body>
</html>
