<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>US Import Cost (Ameriabank SELL)</title>
<style>
body {
    font-family: Arial, sans-serif;
    max-width: 420px;
    margin: auto;
    padding: 20px;
}
input {
    width: 100%;
    padding: 8px;
    margin: 6px 0;
}
button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 16px;
}
.result {
    margin-top: 15px;
    font-weight: bold;
}
.rate {
    font-size: 14px;
    color: #555;
}
</style>
</head>
<body>

<h2>US Import Cost</h2>

<div class="rate" id="rates">Loading Ameriabank SELL ratesâ€¦</div>

<label>Item price (USD)</label>
<input id="priceInput" type="number" step="0.01">

<label>US shipping (USD)</label>
<input id="shippingInput" type="number" step="0.01">

<label>Weight (kg)</label>
<input id="weightInput" type="number" step="0.01">

<button onclick="calculate()">Calculate</button>

<div class="result" id="output"></div>

<script>
let usdAmd = 380; // SELL fallback
let eurAmd = 455; // SELL fallback

async function loadRates() {
    try {
        const res = await fetch(
            "https://api.allorigins.win/raw?url=https://ameriabank.am/en/exchange-rates"
        );
        const html = await res.text();

        /*
          NOTE:
          Ameriabank page structure changes sometimes.
          We intentionally use SELL column numbers (usually the highest).
        */

        const usdMatches = html.match(/USD[\s\S]*?([0-9]+\.[0-9]+)[\s\S]*?([0-9]+\.[0-9]+)/);
        const eurMatches = html.match(/EUR[\s\S]*?([0-9]+\.[0-9]+)[\s\S]*?([0-9]+\.[0-9]+)/);

        if (usdMatches && eurMatches) {
            usdAmd = parseFloat(usdMatches[2]); // SELL
            eurAmd = parseFloat(eurMatches[2]); // SELL
        }

        document.getElementById("rates").innerHTML =
            `Ameriabank SELL rates<br>
             1 USD = ${usdAmd} AMD<br>
             1 EUR = ${eurAmd} AMD`;

    } catch {
        document.getElementById("rates").innerHTML =
            `Using fallback SELL rates<br>
             1 USD = ${usdAmd} AMD<br>
             1 EUR = ${eurAmd} AMD`;
    }
}

function calculate() {
    const price = Number(document.getElementById("priceInput").value);
    const shipping = Number(document.getElementById("shippingInput").value);
    const weight = Number(document.getElementById("weightInput").value);

    if (!price && !shipping && !weight) {
        return;
    }

    const usdToEur = usdAmd / eurAmd;

    const subtotalUSD = price + shipping;
    const subtotalEUR = subtotalUSD * usdToEur;

    let taxEUR = 0;
    if (subtotalEUR > 200) {
        taxEUR = (subtotalEUR - 200) * 0.15;
    }

    const taxAMD = taxEUR * eurAmd;
    const freightAMD = weight * 6000;
    const itemAMD = subtotalUSD * usdAmd;

    const totalAMD = itemAMD + taxAMD + freightAMD;

    document.getElementById("output").innerHTML =
        `Item: ${itemAMD.toFixed(0)} AMD<br>` +
        `Tax: ${taxAMD.toFixed(0)} AMD<br>` +
        `Freight: ${freightAMD.toFixed(0)} AMD<br><br>` +
        `TOTAL: ${totalAMD.toFixed(0)} AMD`;
}

loadRates();
</script>

</body>
</html>
